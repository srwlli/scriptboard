# System Architecture

## ðŸ—ï¸ Topology
Monolith composed of:
- Next.js frontend (App Router) served locally during development or via Electron
- FastAPI backend (localhost:8000)
- Python Core module encapsulating business logic
- Electron shell for desktop experience

```mermaid
graph TD
    U[User] --> E[Electron / Browser]
    E --> F[Next.js Frontend]
    F --> A[FastAPI Backend]
    A --> C[Scriptboard Core]
    C --> S[Filesystem (~/.scriptboard)]
```

## ðŸ“¦ Module Boundaries
- **backend/core.py**: Pure business logic; manages prompt, attachments, responses, token cache, batch jobs
- **backend/api.py**: HTTP API, validation, error envelopes, autosave/session I/O, CORS
- **backend/schemas.py**: Pydantic models, enums (ErrorCode, BatchJobStatus, etc.)
- **frontend/app/**: App Router pages (e.g., `/`, `/settings`)
- **frontend/src/components/**: UI components (Panels, Sections, Controls)
- **frontend/src/lib/api.ts**: `ApiClient` wrapper for backend endpoints
- **shell/**: Electron main process, preload, launch scripts

## ðŸ’¾ Data Flow
1. **Ingestion**: User sets prompt, adds attachments, collects responses via UI; frontend calls FastAPI
2. **Processing**: `ScriptboardCore` mutates in-memory session state; token counts cached; debounced autosave
3. **Storage**: Sessions and autosave JSON saved under `~/.scriptboard/` (e.g., `sessions/*.json`, `autosave.json`)

## ðŸ§  Key Decisions
- **Separation of Concerns**: Core is I/O-free; API handles persistence and transport
- **Local-first Storage**: JSON sessions in user home for simplicity and portability
- **CORS-enabled API**: Open origins for development; tighten in production
- **Desktop Shell**: Electron for integrated app launch, file dialogs, and packaging

---
(Generated by Foundation Docs Agent via POWER Protocol)
