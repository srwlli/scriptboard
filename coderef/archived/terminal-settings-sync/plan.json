{
  "META_DOCUMENTATION": {
    "feature_name": "terminal-settings-sync",
    "schema_version": "1.0.0",
    "version": "1.0.0",
    "status": "complete",
    "generated_by": "AI Assistant",
    "has_context": false,
    "has_analysis": false
  },
  "UNIVERSAL_PLANNING_STRUCTURE": {
    "0_preparation": {
      "foundation_docs": {
        "architecture": "Next.js frontend with Electron desktop app, Python FastAPI backend",
        "schema": "SQLite for local data, JSON for Windows Terminal settings",
        "components": "React components in src/components, Electron main process"
      },
      "key_paths": {
        "frontend": "frontend/src",
        "backend": "backend",
        "mcp_servers": "C:\\Users\\willh\\.mcp-servers",
        "windows_terminal_settings": "C:\\Users\\willh\\AppData\\Local\\Packages\\Microsoft.WindowsTerminal_8wekyb3d8bbwe\\LocalState\\settings.json"
      },
      "reference_patterns": {
        "existing_tools": "frontend/src/components/tools/*",
        "mcp_server_pattern": "C:\\Users\\willh\\.mcp-servers\\scriptboard-mcp"
      }
    },
    "1_executive_summary": {
      "feature_name": "Terminal Settings Sync",
      "description": "Visual UI in Scriptboard to manage Windows Terminal project profiles - add/edit/remove projects, set tab colors, configure hotkeys, and manage starting directories. Implemented as both a direct Scriptboard tool AND a reusable MCP server.",
      "goal": "Replace manual JSON editing with intuitive visual management of Windows Terminal profiles",
      "scope": "Scriptboard desktop app + new terminal-mcp server",
      "estimated_complexity": "medium"
    },
    "2_risk_assessment": {
      "technical_risks": [
        {
          "risk": "Windows Terminal settings.json corruption",
          "severity": "high",
          "mitigation": "Create backup before any write, validate JSON before saving"
        },
        {
          "risk": "File permission issues on Windows",
          "severity": "medium",
          "mitigation": "Handle permission errors gracefully, show user-friendly messages"
        },
        {
          "risk": "Hotkey conflicts with existing system shortcuts",
          "severity": "low",
          "mitigation": "Validate hotkey availability, warn on conflicts"
        }
      ],
      "dependencies": [
        "Windows Terminal installed",
        "Access to LocalState folder",
        "Electron file system access"
      ]
    },
    "3_current_state_analysis": {
      "files_to_create": [
        { "path": "frontend/src/components/tools/TerminalManager.tsx", "purpose": "Main UI component for terminal profile management" },
        { "path": "frontend/src/components/tools/TerminalManager.css", "purpose": "Styles for terminal manager UI" },
        { "path": "frontend/src/lib/terminal-settings.ts", "purpose": "TypeScript utilities for reading/writing settings.json" },
        { "path": "terminal-mcp/src/index.ts", "purpose": "MCP server entry point" },
        { "path": "terminal-mcp/src/tools.ts", "purpose": "MCP tool definitions" },
        { "path": "terminal-mcp/src/terminal-settings.ts", "purpose": "Shared settings manipulation logic" },
        { "path": "terminal-mcp/package.json", "purpose": "MCP server package configuration" }
      ],
      "files_to_modify": [
        { "path": "frontend/src/app/page.tsx", "purpose": "Add Terminal Manager to tool list" },
        { "path": "frontend/src/components/Sidebar.tsx", "purpose": "Add navigation item for Terminal Manager" }
      ],
      "existing_patterns": "Follow existing tool component patterns in frontend/src/components/tools/"
    },
    "4_key_features": {
      "features": [
        {
          "id": "F1",
          "name": "Profile List View",
          "description": "Display all Windows Terminal profiles with name, path, color, and hotkey",
          "priority": "high"
        },
        {
          "id": "F2",
          "name": "Add/Edit Profile",
          "description": "Form to create new profiles or edit existing ones",
          "priority": "high"
        },
        {
          "id": "F3",
          "name": "Color Picker",
          "description": "Visual color picker for tab colors with preset palette",
          "priority": "high"
        },
        {
          "id": "F4",
          "name": "Hotkey Configuration",
          "description": "Capture and assign custom hotkeys to profiles",
          "priority": "medium"
        },
        {
          "id": "F5",
          "name": "Directory Browser",
          "description": "Browse and select starting directory for profiles",
          "priority": "medium"
        },
        {
          "id": "F6",
          "name": "Backup/Restore",
          "description": "Backup settings before changes, restore if needed",
          "priority": "high"
        },
        {
          "id": "F7",
          "name": "MCP Server",
          "description": "Standalone MCP server for terminal management via any LLM client",
          "priority": "medium"
        }
      ]
    },
    "5_task_id_system": {
      "workorder": {
        "id": "WO-TERMINAL-SETTINGS-SYNC-001",
        "name": "Terminal Settings Sync",
        "feature_dir": "coderef/working/terminal-settings-sync"
      },
      "tasks": [
        {
          "id": "SETUP-001",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Create terminal-settings.ts utility for reading/parsing settings.json",
          "feature": "F1",
          "estimated_loc": 150,
          "dependencies": []
        },
        {
          "id": "SETUP-002",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Create TypeScript types for Windows Terminal settings schema",
          "feature": "F1",
          "estimated_loc": 80,
          "dependencies": []
        },
        {
          "id": "UI-001",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Create TerminalManager.tsx component shell with profile list",
          "feature": "F1",
          "estimated_loc": 200,
          "dependencies": ["SETUP-001", "SETUP-002"]
        },
        {
          "id": "UI-002",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Create ProfileCard component for individual profile display",
          "feature": "F1",
          "estimated_loc": 100,
          "dependencies": ["UI-001"]
        },
        {
          "id": "UI-003",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Create ProfileForm component for add/edit functionality",
          "feature": "F2",
          "estimated_loc": 180,
          "dependencies": ["UI-001"]
        },
        {
          "id": "UI-004",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Implement color picker with preset project colors",
          "feature": "F3",
          "estimated_loc": 80,
          "dependencies": ["UI-003"]
        },
        {
          "id": "UI-005",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Implement hotkey capture input component",
          "feature": "F4",
          "estimated_loc": 120,
          "dependencies": ["UI-003"]
        },
        {
          "id": "UI-006",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Implement directory browser/picker",
          "feature": "F5",
          "estimated_loc": 100,
          "dependencies": ["UI-003"]
        },
        {
          "id": "CORE-001",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Implement backup functionality before writes",
          "feature": "F6",
          "estimated_loc": 60,
          "dependencies": ["SETUP-001"]
        },
        {
          "id": "CORE-002",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Implement write settings with validation",
          "feature": "F2",
          "estimated_loc": 100,
          "dependencies": ["SETUP-001", "CORE-001"]
        },
        {
          "id": "CORE-003",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Implement add/update/delete profile operations",
          "feature": "F2",
          "estimated_loc": 150,
          "dependencies": ["CORE-002"]
        },
        {
          "id": "CORE-004",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Implement keybinding management (add/update/remove)",
          "feature": "F4",
          "estimated_loc": 120,
          "dependencies": ["CORE-002"]
        },
        {
          "id": "MCP-001",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Create terminal-mcp server scaffold with package.json",
          "feature": "F7",
          "estimated_loc": 50,
          "dependencies": []
        },
        {
          "id": "MCP-002",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Implement list_profiles MCP tool",
          "feature": "F7",
          "estimated_loc": 80,
          "dependencies": ["MCP-001", "SETUP-001"]
        },
        {
          "id": "MCP-003",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Implement add_profile MCP tool",
          "feature": "F7",
          "estimated_loc": 100,
          "dependencies": ["MCP-002"]
        },
        {
          "id": "MCP-004",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Implement update_profile and delete_profile MCP tools",
          "feature": "F7",
          "estimated_loc": 120,
          "dependencies": ["MCP-003"]
        },
        {
          "id": "MCP-005",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Implement set_hotkey MCP tool",
          "feature": "F7",
          "estimated_loc": 80,
          "dependencies": ["MCP-004"]
        },
        {
          "id": "INT-001",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Add Terminal Manager to Scriptboard navigation/routing",
          "feature": "F1",
          "estimated_loc": 30,
          "dependencies": ["UI-001"]
        },
        {
          "id": "INT-002",
          "workorder_id": "WO-TERMINAL-SETTINGS-SYNC-001",
          "description": "Register terminal-mcp in Claude config",
          "feature": "F7",
          "estimated_loc": 10,
          "dependencies": ["MCP-005"]
        }
      ]
    },
    "6_implementation_phases": {
      "phases": [
        {
          "phase": 1,
          "name": "Foundation",
          "description": "Core utilities and types for settings manipulation",
          "tasks": ["SETUP-001", "SETUP-002", "CORE-001"],
          "deliverables": [
            "terminal-settings.ts utility with read/parse/backup",
            "TypeScript interfaces for Windows Terminal schema"
          ]
        },
        {
          "phase": 2,
          "name": "Core Operations",
          "description": "CRUD operations for profiles and keybindings",
          "tasks": ["CORE-002", "CORE-003", "CORE-004"],
          "deliverables": [
            "Write settings with validation",
            "Profile add/update/delete functions",
            "Keybinding management functions"
          ]
        },
        {
          "phase": 3,
          "name": "Scriptboard UI",
          "description": "Visual interface in Scriptboard app",
          "tasks": ["UI-001", "UI-002", "UI-003", "UI-004", "UI-005", "UI-006", "INT-001"],
          "deliverables": [
            "TerminalManager component with full UI",
            "ProfileCard and ProfileForm components",
            "Color picker, hotkey capture, directory browser",
            "Navigation integration"
          ]
        },
        {
          "phase": 4,
          "name": "MCP Server",
          "description": "Standalone MCP server for LLM access",
          "tasks": ["MCP-001", "MCP-002", "MCP-003", "MCP-004", "MCP-005", "INT-002"],
          "deliverables": [
            "terminal-mcp server package",
            "5 MCP tools: list, add, update, delete, set_hotkey",
            "Claude config registration"
          ]
        }
      ]
    },
    "7_testing_strategy": {
      "unit_tests": [
        "Test settings.json parsing with various formats",
        "Test profile CRUD operations",
        "Test keybinding validation",
        "Test backup/restore functionality"
      ],
      "integration_tests": [
        "Test full add profile flow in UI",
        "Test MCP tools via mock client",
        "Test settings persistence across app restart"
      ],
      "manual_tests": [
        "Verify profiles appear in Windows Terminal dropdown",
        "Verify hotkeys work in Windows Terminal",
        "Verify tab colors display correctly"
      ]
    },
    "8_success_criteria": {
      "functional": [
        "Can list all Windows Terminal profiles in Scriptboard",
        "Can add new project profile with name, path, color, hotkey",
        "Can edit existing profile properties",
        "Can delete profiles",
        "Can assign custom hotkeys that work in Windows Terminal",
        "MCP tools work via Claude CLI"
      ],
      "non_functional": [
        "Settings changes reflected in Windows Terminal within 2 seconds",
        "Backup created before every write operation",
        "No data loss on error - original settings preserved"
      ]
    },
    "9_implementation_checklist": {
      "phase_1_checklist": [
        "[ ] Create terminal-settings.ts with readSettings()",
        "[ ] Create terminal-settings.ts with parseProfiles()",
        "[ ] Create terminal-settings.ts with createBackup()",
        "[ ] Create TypeScript types for Profile, Action, Keybinding",
        "[ ] Test reading actual Windows Terminal settings.json"
      ],
      "phase_2_checklist": [
        "[ ] Implement writeSettings() with JSON validation",
        "[ ] Implement addProfile() function",
        "[ ] Implement updateProfile() function",
        "[ ] Implement deleteProfile() function",
        "[ ] Implement addKeybinding() function",
        "[ ] Implement updateKeybinding() function",
        "[ ] Test full CRUD cycle"
      ],
      "phase_3_checklist": [
        "[ ] Create TerminalManager.tsx shell",
        "[ ] Create ProfileCard component",
        "[ ] Create ProfileForm component",
        "[ ] Add color picker with presets",
        "[ ] Add hotkey capture input",
        "[ ] Add directory browser",
        "[ ] Add to Scriptboard navigation",
        "[ ] Style with TerminalManager.css"
      ],
      "phase_4_checklist": [
        "[ ] Create terminal-mcp package scaffold",
        "[ ] Implement list_profiles tool",
        "[ ] Implement add_profile tool",
        "[ ] Implement update_profile tool",
        "[ ] Implement delete_profile tool",
        "[ ] Implement set_hotkey tool",
        "[ ] Add to Claude config",
        "[ ] Test all tools via Claude CLI"
      ]
    }
  }
}
